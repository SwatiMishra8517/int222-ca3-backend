(this.webpackJsonpstarter=this.webpackJsonpstarter||[]).push([[0],{24:function(e,t,n){},37:function(e,t,n){e.exports=n(53)},42:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(26),o=n.n(c),l=(n(42),n(4)),i=n(13),s=n(10),u=n(12),m=n(2),d=(n(24),{"Content-Type":"application/json"}),p={get:function(e){return fetch(e).then((function(e){return e.json()}))},post:function(e,t){return fetch(e,{method:"POST",body:JSON.stringify(t),headers:d}).then((function(e){return e.json()}))}},g=p,f=n(3),b=n(9);function E(){var e=Object(a.useContext)(J),t=e.setUser,n=e.user,c=Object(a.useState)(""),o=Object(l.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(""),m=Object(l.a)(u,2),d=m[0],p=m[1],E=Object(a.useState)(""),v=Object(l.a)(E,2),h=v[0],j=v[1],O=Object(f.g)();return n?r.a.createElement(f.a,{to:"/"}):r.a.createElement("div",{className:"login"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),g.post("/auth/login",{email:i,password:d}).then((function(e){e.error?j(e.error):(t(e.user),O.push("/"),localStorage.setItem("user",JSON.stringify(e.user)))}))}},r.a.createElement("h1",null,"Login"),r.a.createElement("p",{style:{color:"red"}},h),r.a.createElement("input",{onChange:function(e){return s(e.target.value)},type:"email",placeholder:"Email"}),r.a.createElement("input",{onChange:function(e){return p(e.target.value)},type:"password",placeholder:"Password"}),r.a.createElement("input",{type:"submit",value:"login"}),r.a.createElement("p",null,"If not registered then ",r.a.createElement(b.b,{to:"/signup"},"Signup"))))}E.contextType=J;var v=E;var h=function(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),i=Object(l.a)(o,2),s=i[0],u=i[1],m=Object(a.useState)(""),d=Object(l.a)(m,2),p=d[0],E=d[1],v=Object(a.useState)(""),h=Object(l.a)(v,2),j=h[0],O=h[1],y=Object(a.useState)(""),w=Object(l.a)(y,2),C=w[0],x=w[1],S=Object(a.useState)(""),_=Object(l.a)(S,2),N=_[0],k=_[1],I=Object(f.g)();return r.a.createElement("div",{className:"login"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),g.post("/auth/signup",{name:n,email:s,password:p,username:j}).then((function(e){e.error?x(e.error):(k("you are registered successfully"),setTimeout((function(){I.push("/login")}),2e3))}))}},r.a.createElement("h1",null,"Signup"),r.a.createElement("p",{style:{color:"red"}},C),r.a.createElement("p",{style:{color:"green"}},N),r.a.createElement("input",{onChange:function(e){return c(e.target.value)},type:"text",name:"name",placeholder:"name"}),r.a.createElement("input",{onChange:function(e){return O(e.target.value)},type:"text",placeholder:"username"}),r.a.createElement("input",{onChange:function(e){return u(e.target.value)},type:"text",name:"email",placeholder:"email"}),r.a.createElement("input",{onChange:function(e){return E(e.target.value)},type:"password",name:"pwd",placeholder:"password"}),r.a.createElement("input",{type:"submit",value:"signup"}),r.a.createElement("p",null,"If already registered then ",r.a.createElement(b.b,{to:"/login"},"Login"))))},j=n(29);var O=function(){var e=Object(a.useContext)(G).user,t=Object(f.g)();return e?r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{onClick:function(){t.push("/")},style:{cursor:"pointer",margin:10,display:"flex",alignItems:"center",alignSelf:"flex-start",padding:10,background:"steelblue",color:"white",borderRadius:5}},r.a.createElement(j.a,{size:32})," Go to Home")),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},r.a.createElement("div",{flex:"4"},r.a.createElement("img",{style:{width:"200px",objectFit:"contain"},alt:"user",src:/\w+[ai]$/.test(e.name)?"https://www.kindpng.com/picc/m/695-6955645_female-user-female-user-icon-png-transparent-png.png":"https://readyrefrigeration.ca/sites/default/files/styles/headshot/adaptive-image/public/nobody.jpg"}),r.a.createElement("h1",null,e.name),r.a.createElement("p",null,"@",e.username),r.a.createElement("p",null,e.email)))):r.a.createElement(f.a,{to:"/"})},y=(n(48),n(30)),w=n(31),C=(new(function(){function e(){var t=this;Object(y.a)(this,e),this.socket=window.io("/"),this.socket.on("connect",(function(e){t.onConnect(),t.onMessage()}))}return Object(w.a)(e,[{key:"onConnect",value:function(){}},{key:"onMessage",value:function(){this.socket.on("sentMessage",(function(e){console.log("RECEIVED",e)}))}}]),e}())).socket,x=n(32),S=n.n(x),_={NEW_MESSAGE:new Audio("https://www.mobilesringtones.com/static/p/ringtones/2017/10/02/15726/15726.mp3?title=15726_download_iphone_sms_original_ringtone_iphone_sms_ringtones.mp3"),USER_JOINED:new Audio("https://www.mobilesringtones.com/static/p/ringtones/2017/11/26/15953/15953.mp3?title=15953_download_mesg_ting_ringtone_apple_sms_ringtones.mp3"),MESSAGE_SENT:new Audio("https://fsb.zobj.net/download/bHTSKVD0pv8_4rq--Z8g7fhojB2O5VH143lYmr205vVtLj8tnIh7yL9elamAe88Zs2z7EgWnCdeLaGein239bmckpam5mKQK8LIsw1BoMNNmTIUW47Y0lCgzGwN0/?a=web&c=72&f=pop_up_sms_tone.mp3&special=1603348222-f3GLlOXpN82goF5WwVpLp8aUmOZjkPgVdmnDje6rCso%3D")},N=n(33);var k=function(){var e=Object(a.useContext)(G).user,t=null,n=r.a.useState(!1),c=Object(l.a)(n,2),o=c[0],i=c[1],d=Object(a.useContext)(G),p=d.contacts,g=d.messages,f=d.currentContact,b=d.setMessages,E=(null===p||void 0===p?void 0:p.find((function(e){return e.uid===f})))||{},v=g[f]||[],h=document.getElementById("textarea"),j=r.a.useRef(),O=function(){j.current.scrollTo({top:j.current.scrollHeight,behavior:"smooth"})};return Object(a.useEffect)((function(){b((function(e){return e[f]||(e[f]=[]),Object(m.a)(Object(m.a)({},e),{},Object(s.a)({},f,Object(u.a)(e[f]).map((function(e){return Object(m.a)(Object(m.a)({},e),{},{unread:void 0})}))))}))}),[f]),Object(a.useEffect)((function(){var e;(null===(e=v[v.length-1])||void 0===e?void 0:e.user)&&O()}),[g]),r.a.createElement("div",{className:"chatbox"},r.a.createElement("header",{style:{display:"flex",alignItems:"center",padding:"10px 0px 10px 20px"}},r.a.createElement("img",{style:{height:40,width:40,borderRadius:"50%"},alt:"user",src:/\w+[ai]$/.test(e.name)?"https://www.kindpng.com/picc/m/695-6955645_female-user-female-user-icon-png-transparent-png.png":"groupChat"===E.uid?"https://www.flaticon.com/svg/static/icons/svg/166/166258.svg":"https://readyrefrigeration.ca/sites/default/files/styles/headshot/adaptive-image/public/nobody.jpg"}),r.a.createElement("div",{style:{margin:"0px 20px"}},r.a.createElement("h1",null,E.username),E.typing?r.a.createElement("div",{style:{color:"white",margin:0,padding:0}},E.sender?E.sender+": typing...":"typing..."):"")),r.a.createElement("div",{className:"sections",ref:j},v.map((function(t){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("div",{className:"".concat(t.user||t.sender===e.username?"message_sender":"message_receiver"," message")},t.sender&&t.sender!==e.username&&r.a.createElement("div",{style:{color:"#253757",fontWeight:"bold",fontSize:"90%"}},t.sender),r.a.createElement("span",{dangerouslySetInnerHTML:{__html:t.text}}),r.a.createElement("div",{style:{color:"#c1c1c1",fontSize:"70%",alignSelf:"flex-end",textAlign:"right"}},S()(new Date(t.time)).calendar())))}))),r.a.createElement("footer",null,r.a.createElement("div",{className:"scroll-top",onClick:O},r.a.createElement(N.a,{size:34,color:"white"})),r.a.createElement("div",{id:"text-container"},r.a.createElement("p",{id:"textarea",placeholder:"Type a message..",contentEditable:!0,onKeyPress:function(){clearTimeout(t),o||C.emit("typeStart",{to:f}),i(!0),t=setTimeout((function(){o&&(C.emit("typeEnd",{to:f}),i(!1))}),2e3)}}),r.a.createElement("button",{onClick:function(){var e=h.innerText;e=e.replace(/\n/g,"<br>").trim(),console.log(e),""!==e.trim()&&(C.emit("message",{text:e,to:f}),_.MESSAGE_SENT.play(),h.innerText="",b((function(t){return t[f]||(t[f]=[]),Object(m.a)(Object(m.a)({},t),{},Object(s.a)({},f,[].concat(Object(u.a)(t[f]),[{text:e,user:!0,time:Date.now()}])))})))}},"send"))))},I=(n(50),n(34)),T=n(35);var z=function(){var e=Object(a.useContext)(G),t=(e.user,e.contacts),n=e.setCurrentContact,c=e.currentContact,o=e.messages,i=Object(a.useState)(t),s=Object(l.a)(i,2),u=s[0],m=s[1];return Object(a.useEffect)((function(){m(t)}),[t]),r.a.createElement("div",{class:"container"},r.a.createElement("div",{className:"search"},r.a.createElement(I.a,{size:20}),r.a.createElement("input",{type:"search",placeholder:"Search contact",onChange:function(e){var n=e.target.value.toLowerCase();m(t.filter((function(e){return e.username.toLowerCase().startsWith(n)})))}})),r.a.createElement("div",{className:"friends"},!t&&r.a.createElement("div",null,"Loading contacts..."),0==(null===u||void 0===u?void 0:u.length)&&r.a.createElement("div",null,"No contacts to show."),null===u||void 0===u?void 0:u.map((function(e){var t,a=o[e.uid]||[],l=a.filter((function(e){return e.unread})).length,i=a[a.length-1];return r.a.createElement("div",{className:"".concat(e.uid===c?"active_contact":""," contact"),onClick:function(t){return n(e.uid)}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("img",{style:{height:40,width:40,borderRadius:"50%"},alt:"user",src:/\w+[ai]$/.test(e.name)?"https://www.kindpng.com/picc/m/695-6955645_female-user-female-user-icon-png-transparent-png.png":"groupChat"===e.uid?"https://www.flaticon.com/svg/static/icons/svg/166/166258.svg":"https://readyrefrigeration.ca/sites/default/files/styles/headshot/adaptive-image/public/nobody.jpg"}),r.a.createElement("div",{className:"contact_container"},r.a.createElement("div",{className:"contact_name"},e.username,e.online&&r.a.createElement("div",{className:"online"})),r.a.createElement("div",{style:{fontSize:"90%",color:"grey",whiteSpace:"nowrap",padding:"5px 0 0 0",display:"flex",alignItems:"center"}},a.length>0&&!e.typing&&(null===i||void 0===i?void 0:i.user)?r.a.createElement(T.a,{style:{padding:"0 5px 0 0"}}):(null===i||void 0===i?void 0:i.sender)&&!e.typing?i.sender+": ":"",e.typing?r.a.createElement("div",{style:{color:"green",fontWeight:"bold"}},e.sender?e.sender+": typing...":"typing..."):i&&r.a.createElement("div",{style:{fontWeight:i.unread?"bold":"normal"}},(null===i||void 0===i||null===(t=i.text)||void 0===t?void 0:t.replace(/<br>/g," ").split("").slice(0,35).join(""))+"..."||!1)))),l>0&&e.uid!==c&&r.a.createElement("div",{className:"badge"},l))}))))},L=(n(51),n(21)),M=n(36);n(52);var D=function(e){var t=e.icon;return r.a.createElement("div",Object.assign({className:"navigation__tab"},e),r.a.createElement(t,{style:{color:"white",fontSize:e.size}}),r.a.createElement("div",{style:{color:"white",paddingTop:"10px"}},e.label))};var A=function(){Object(f.g)();var e=Object(a.useContext)(J).setUser;return r.a.createElement("div",{className:"Nav"},r.a.createElement(b.b,{to:"/",className:"nav-link"},r.a.createElement(D,{label:"Home",icon:L.a,size:32})),r.a.createElement(b.b,{to:"/profile",className:"nav-link"},r.a.createElement(D,{label:"Profile",icon:L.b,size:32})),r.a.createElement(D,{onClick:function(){localStorage.removeItem("user"),e(null),C.disconnect(),window.location.href="/login"},label:"Logout",icon:M.a,size:32}))};var U=function(){var e=Object(a.useContext)(J),t=e.user;return e.setContacts,e.setCurrentContact,t?r.a.createElement("div",null,r.a.createElement(k,null),r.a.createElement(z,null),r.a.createElement(A,null)):r.a.createElement(f.a,{to:"/login"})};var W=function(){var e=Object(a.useContext)(J),t=e.setUser,n=e.user,c=e.setContacts,o=e.setMessages,l=(e.currentContact,e.contacts),i=e.setCurrentContact;return Object(a.useEffect)((function(){var e=localStorage.getItem("user");e&&(console.log(e),e=JSON.parse(e),t(e)),C.on("allUsers",(function(e){if(0!=e.length){var t=e.map((function(e){return Object(m.a)(Object(m.a)({},e),{},{uid:e._id})}));c([].concat(Object(u.a)(t),[{uid:"groupChat",username:"Mega Chat"}])),i(t[0].uid)}else c([])})),C.on("newUser",(function(e){c((function(t){return null===t||void 0===t?void 0:t.map((function(t){return t.uid===e?Object(m.a)(Object(m.a)({},t),{},{online:!0}):t}))}))})),C.on("userLeft",(function(e){c((function(t){return null===t||void 0===t?void 0:t.map((function(t){return t.uid===e?Object(m.a)(Object(m.a)({},t),{},{online:!1}):t}))}))})),C.on("groupChats",(function(t){o((function(n){return n.groupChat||(n.groupChat=[]),Object(m.a)(Object(m.a)({},n),{},{groupChat:t.map((function(t){var n;return Object(m.a)(Object(m.a)({},t),{},{sender:t.from,user:t.from===(null===(n=e)||void 0===n?void 0:n.username)})}))})}))})),C.on("receiveMessage",(function(e){var t=e.from;e.sender&&(t="groupChat",console.log(l)),console.log(e),void 0===e.typing?(_.NEW_MESSAGE.play(),o((function(n){return n[t]||(n[t]=[]),Object(m.a)(Object(m.a)({},n),{},Object(s.a)({},t,[].concat(Object(u.a)(n[t]),[{text:e.text,unread:!0,sender:"groupChat"===t?e.sender:void 0,time:Date.now()}])))}))):e.typing?c((function(n){return n.map((function(n){return n.uid===t?Object(m.a)(Object(m.a)({},n),{},{typing:!0,sender:e.sender}):n}))})):c((function(n){return n.map((function(n){return n.uid===t?Object(m.a)(Object(m.a)({},n),{},{typing:!1,sender:e.sender}):n}))}))}))}),[]),Object(a.useEffect)((function(){n&&C.emit("join",n)}),[n]),r.a.createElement(b.a,null,r.a.createElement("div",null,r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/"},r.a.createElement(U,null)),r.a.createElement(f.b,{path:"/login"},r.a.createElement(v,null)),r.a.createElement(f.b,{path:"/profile"},r.a.createElement(O,null)),r.a.createElement(f.b,{path:"/signup"},r.a.createElement(h,null)))))},G=Object(a.createContext)();function H(e){var t=e.children,n=r.a.useState(null),a=Object(l.a)(n,2),c=a[0],o=a[1],s=Object(i.b)(null,"contacts"),u=Object(l.a)(s,2),m=u[0],d=u[1],p=Object(i.b)({},"messages"),g=Object(l.a)(p,2),f=g[0],b=g[1],E=Object(i.b)(null,"currentContact"),v=Object(l.a)(E,2),h=v[0],j=v[1];return r.a.createElement(G.Provider,{value:{user:c,setUser:o,messages:f,setMessages:b,contacts:m,setContacts:d,currentContact:h,setCurrentContact:j}},t)}var J=G;o.a.render(r.a.createElement(i.a,{name:"Chat"},r.a.createElement(H,null,r.a.createElement(W,null))),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.3d65719e.chunk.js.map